# GB$ (Goodbody Bucks) - Family Economy System

## ğŸ¯ What Is Goodbody Bucks?

**Goodbody Bucks (GB$)** is a family economy and learning rewards system designed to teach kids valuable life skills through a fun, interactive game. Kids earn virtual currency (GB$) by completing educational activities, then spend their earnings on food and screen time. The system includes a timer that tracks screen time usage, teaching kids about time management and responsible spending.

Think of it as a **real-world economy simulator** for your familyâ€”kids learn that money must be earned through effort, and that spending decisions have real consequences.

---

## ğŸ“š How It Teaches Kids

### 1. **Financial Literacy**
- **Earning Money**: Kids learn that money comes from work, not just given freely
- **Spending Decisions**: They must choose between different purchases (food vs. screen time)
- **Budgeting**: Limited GB$ means kids must plan and prioritize their spending
- **Value Understanding**: Different items cost different amounts, teaching relative value

### 2. **Academic Skills Reinforcement**
- **Math**: Kids earn GB$ for solving math problems correctly
- **Reading**: Rewards for reading pages aloud or completing reading activities
- **Spelling**: Earn money for spelling words correctly
- **Writing**: Rewards for writing sentences and completing writing tasks

### 3. **Time Management**
- **Timer System**: Screen time minutes are tracked in real-time
- **Planning**: Kids must decide how much screen time to purchase
- **Responsibility**: Minutes count down during active sessionsâ€”kids learn to use time wisely

### 4. **Accountability & Consequences**
- **Positive Reinforcement**: Earning GB$ for good behavior and learning
- **Natural Consequences**: Spending all GB$ means no more purchases until more is earned
- **Disciplinary Actions**: Parents can apply time or money consequences when needed
- **Purchase History**: Kids can see their spending patterns and learn from them

### 5. **Real-World Skills**
- **Decision Making**: Choosing between immediate gratification (screen time) and needs (food)
- **Delayed Gratification**: Saving GB$ for larger purchases
- **Goal Setting**: Working toward earning enough for desired items
- **Tracking**: Viewing purchase history teaches financial record-keeping

---

## ğŸ® Game Features & Sections

### For Kids

#### **Wallet Display**
- **Large, Visual Display**: Shows GB$ balance and available screen time minutes prominently
- **Real-Time Updates**: Balance updates immediately after purchases or rewards
- **Status Indicators**: 
  - ğŸ”’ Shows if screens are locked
  - â–¶ï¸ Shows active timer session with elapsed time
  - â¸ï¸ Shows when no session is active

**What Kids Learn**: How to check their balance, understand their available resources, and track their spending power.

#### **Earning GB$ (Learning Rewards)**
Kids earn GB$ by completing educational activities. Parents (admins) award these rewards:

- **Math Rewards**:
  - Correct problem: +$0.25
  - 3 correct in a row: +$0.50
  - Hard problem: +$1.00

- **Reading Rewards**:
  - 1 page read aloud: +$0.25
  - 5 pages read: +$1.00

- **Spelling Rewards**:
  - 1 word spelled correctly: +$0.25

- **Writing Rewards**:
  - 1 sentence written: +$0.50

**What Kids Learn**: That learning and academic effort have tangible rewards, creating positive reinforcement for educational activities.

#### **Spending GB$ - Food Menu**
Kids can purchase food items using their GB$:

**Breakfast Items**:
- Eggs: $2.00
- Bacon: $3.00
- Sausage: $3.00
- Waffles: $4.00
- Chobani Flip Yogurt: $2.50

**Lunch Items**:
- Poor Man's Sandwich: $5.00
- Nuggets + Fries: $6.00
- Coke (Can): $1.00

**Dinner Items**:
- Spaghetti: $7.00
- Tacos (2): $6.00
- Dessert: $2.50

**What Kids Learn**: 
- Different items have different values
- Must budget for meals throughout the day
- Choices have opportunity costs (buying expensive dinner means less for other things)

#### **Spending GB$ - Screen Time Packages**
Kids purchase screen time minutes using GB$:

**Tablet Time**:
- 10 minutes: $0.50
- 20 minutes: $1.00
- 30 minutes: $1.50
- 45 minutes: $2.25
- 60 minutes: $3.00

**Gaming Time**:
- 15 minutes: $0.75
- 30 minutes: $1.50
- 45 minutes: $2.25
- 60 minutes: $3.00

**What Kids Learn**:
- Screen time is a privilege that must be earned
- Longer sessions cost more, teaching value comparison
- Must balance entertainment spending with other needs

#### **Timer System**
- **Start Session**: Kids start a timer when they begin using their purchased screen time
- **Real-Time Tracking**: Minutes count down automatically during active sessions
- **Auto-Stop**: Session ends when minutes reach zero
- **Manual Stop**: Kids or parents can stop sessions early

**What Kids Learn**:
- Time is a finite resource
- Must use purchased time wisely
- Time management and self-control

#### **Visual Menu System**
- **Menu Images**: Kids can view full menu images showing all available items
- **Click to Buy**: Simple click-to-purchase interface
- **Visual Cards**: Each item shows image, name, and price
- **Toggle View**: Switch between visual menus and traditional dropdowns

**What Kids Learn**: Modern digital interfaces, visual decision-making, and user experience design.

#### **Purchase History**
- **Transaction Log**: View last 50 purchases
- **Details**: See what was bought, when, and how much it cost
- **Pattern Recognition**: Kids can see their spending habits

**What Kids Learn**: Financial record-keeping, spending pattern awareness, and reflection on past decisions.

---

### For Parents (Admins)

#### **Family Management**
- **Create Family**: Set up your family economy system
- **Add Members**: Manually add family members if needed
- **Remove Members**: Clean up test accounts or remove family members
- **Reset Kid Values**: Reset balances and minutes if needed (useful for starting over or fixing errors)

#### **Reward System**
- **Award Learning Rewards**: Give GB$ to kids for completing educational activities
- **Select from Catalog**: Choose from predefined rewards (math, reading, spelling, writing)
- **Custom Amounts**: Award any amount of GB$ for any reason

**Educational Purpose**: Reinforces positive learning behaviors, creates incentive for academic work, and teaches that effort leads to rewards.

#### **Daily Allotments**
- **Set Daily Allowances**: Give kids a regular GB$ allowance
- **Per-Child Amounts**: Set different amounts for each child
- **Consistent Income**: Teaches kids about regular income sources

**Educational Purpose**: Introduces the concept of regular income, helps with budgeting, and provides a baseline for financial planning.

#### **Consequences System**

**Time Consequences** (affect screen time minutes):
- **-5 minutes**: Remove 5 minutes of screen time
- **-10 minutes**: Remove 10 minutes of screen time
- **End current session**: Stop active session and set minutes to 0
- **Lock screens for today**: Prevent all screen time for the day
- **Unlock screens**: Remove screen lock

**Money Consequences** (affect GB$ balance):
- **-$0.25**: Small deduction
- **-$0.50**: Medium deduction
- **-$1.00**: Large deduction
- **-$2.00**: Very large deduction

**Educational Purpose**: 
- Teaches accountability for actions
- Shows that poor choices have financial consequences
- Reinforces cause-and-effect thinking
- Helps kids understand real-world consequences of behavior

#### **Monitor All Kids**
- **View All Wallets**: See all kids' GB$ balances and minutes at once
- **View Purchase History**: Check any kid's spending history
- **Session Status**: See which kids have active timer sessions
- **Lock Status**: See which kids have locked screens

**Educational Purpose**: Allows parents to track progress, identify spending patterns, and provide guidance when needed.

---

## ğŸ—ï¸ Technical Architecture

- **Frontend**: Single-page `index.html` (no build tools) - can run locally or on Firebase Hosting
- **Backend**: Python Flask `app.py` (local dev, then Cloud Run)
- **Auth**: Firebase Auth (Email/Password)
- **Database**: Firestore
- **Dependencies**: Flask + firebase-admin only

---

## ğŸš€ Quick Start Guide

### 1. Prerequisites

- Python 3.8+
- Firebase project with:
  - Authentication enabled (Email/Password)
  - Firestore enabled
  - Service account key

### 2. Firebase Setup

1. Go to [Firebase Console](https://console.firebase.google.com/)
2. Create a new project (or use existing)
3. Enable **Authentication** â†’ Sign-in method â†’ Email/Password
4. Enable **Firestore Database** â†’ Create database (start in production mode)
5. Go to **Project Settings** â†’ **Service Accounts** â†’ **Generate New Private Key**
6. Save the JSON file as `serviceAccountKey.json` in the project root

### 3. Install Dependencies

```bash
python.exe -m pip install -r requirements.txt
```

### 4. Configure Firebase in Frontend

Edit `index.html` and replace the Firebase config:

```javascript
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
  projectId: "YOUR_PROJECT_ID"
};
```

Get these values from Firebase Console â†’ Project Settings â†’ General â†’ Your apps

### 5. Run Locally

```bash
python app.py
```

Open http://localhost:5000 in your browser.

### 6. First-Time Setup

1. **Create Family**: Enter family name and click "Create Family"
2. **Admin Login**: 
   - Enter the Family ID from step 1
   - Enter admin email/password (create account in Firebase Auth first, or use bootstrap)
   - Click "Login Admin"
   - First admin login will auto-bootstrap as admin
3. **Kid Login**:
   - Enter Family ID
   - Enter kid name (e.g., "Miles") and PIN
   - System creates email: `miles.{familyId}@gbucks.local`
   - First kid login will auto-bootstrap as kid

---

## ğŸ“± Testing on Android/LAN

1. Find your PC's LAN IP: `ipconfig` (Windows) or `ifconfig` (Mac/Linux)
2. On Android device, open: `http://<PC_LAN_IP>:5000`
3. Ensure firewall allows port 5000

---

## ğŸ”Œ API Endpoints

All endpoints require:
- `Authorization: Bearer <idToken>` header
- `X-Family-Id: <family_id>` header

### Public
- `POST /api/setup_family` - Create new family
- `GET /api/health` - Health check

### Bootstrap
- `POST /api/bootstrap` - Auto-register first-time users (called automatically on login)

### Admin & Kid
- `GET /api/catalog` - Get rewards, packages, menu
- `GET /api/state` - Get all kids' wallet/session state
- `GET /api/purchase_history?kid_user_id=<uid>` - Get purchase history (last 50)

### Kid Only
- `POST /api/purchase_screen` - Buy screen time package
- `POST /api/purchase_food` - Buy food item
- `POST /api/session/start` - Start timer session
- `POST /api/session/stop` - Stop timer session

### Admin Only
- `POST /api/admin/add_member` - Manually add member
- `POST /api/daily_allotment` - Apply daily GB$ allotments
- `POST /api/reward` - Reward kid for action
- `POST /api/consequence_time` - Apply time consequence
- `POST /api/consequence_money` - Apply money consequence

---

## ğŸ”„ Bootstrap Rules

The bootstrap endpoint (`/api/bootstrap`) safely handles first-time registration:

1. **First user** â†’ Becomes admin automatically
2. **Kid email pattern** (`{name}.{familyId}@gbucks.local`) â†’ Auto-registers as kid
3. **Explicit admin** â†’ Only if family already has at least one admin
4. **Explicit kid** â†’ Requires existing admin in family

No manual Firestore edits needed!

---

## ğŸ’¾ Data Structure

```
families/{familyId}/
  â”œâ”€â”€ name, createdTs, config
  â”œâ”€â”€ members/{uid}/
  â”‚   â””â”€â”€ name, role, createdTs
  â”œâ”€â”€ wallets/{uid}/
  â”‚   â””â”€â”€ balanceGb, minutes, locked, updatedTs
  â”œâ”€â”€ sessions/{uid}/
  â”‚   â””â”€â”€ active, mode, startTs, endTs, updatedTs
  â”œâ”€â”€ purchases/{docId}/
  â”‚   â””â”€â”€ kidUid, ts, type, label, costGb, extra
  â””â”€â”€ ledger/{docId}/
      â””â”€â”€ ts, actorUid, targetUid, type, payload, prevHash, hash
```

---

## âœ… Testing Checklist

1. âœ… Create family
2. âœ… Admin login (first user becomes admin)
3. âœ… Kid login with PIN (auto-creates derived email)
4. âœ… Reward kid (add GB$)
5. âœ… Buy screen time (deduct GB$, add minutes)
6. âœ… Start timer session
7. âœ… Time consequence (lock_day)
8. âœ… Purchase history view

---

## â“ Common Issues

### "Missing Bearer token"
- Make sure you're logged in (Firebase Auth)
- Check that `idToken` is being sent in headers

### "Missing X-Family-Id header"
- Enter Family ID in the login form
- Family ID is shown after creating family

### "Access is denied" (service account)
- Ensure `serviceAccountKey.json` is in project root
- Or set `GOOGLE_APPLICATION_CREDENTIALS` environment variable

### "Family not found"
- Create family first using `/api/setup_family`
- Verify Family ID is correct

### Timer not counting down
- Timer reconciliation happens on `/api/state` calls
- Minutes decrement based on elapsed time since `startTs`
- Session auto-stops when minutes hit 0

---

## ğŸ”§ Environment Variables

- `GOOGLE_APPLICATION_CREDENTIALS` - Path to service account JSON (default: `./serviceAccountKey.json`)
- `FIREBASE_PROJECT_ID` - Firebase project ID (optional, auto-detected from service account)
- `PORT` - Server port (default: 5000)

---

## ğŸš¢ Deployment

### Firebase Hosting (Frontend)
```bash
firebase init hosting
firebase deploy --only hosting
```

### Cloud Run (Backend)
```bash
gcloud run deploy gbucks-api --source .
```

---

## ğŸ“„ License

Private project - Goodbody Bucks
